

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Using STScI Linux Servers &mdash; aplc-optimization  documentation</title>
  

  
  <link rel="stylesheet" href="_static/stsci.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="_static/stsci.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="_static/logo.jpg"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Design Survey Workflow" href="workflow.html" />
    <link rel="prev" title="Requirements &amp; Installation" href="installing.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          
            <a href="index.html" class="icon icon-home"> aplc-optimization
            
            <img src="_static/stsci_pri_combo_mark_white.png" class="logo" />
          </a>

          
            
            
          
          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
  
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installing.html">Requirements &amp; Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Using STScI Linux Servers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#getting-started">Getting Started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#verifying-network-mounts">Verifying network mounts</a></li>
<li class="toctree-l3"><a class="reference internal" href="#logging-into-a-server">Logging into a server</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#software-installation">Software Installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installing-conda">Installing Conda</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installing-aplc-optimization">Installing <code class="docutils literal notranslate"><span class="pre">aplc-optimization</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#installing-gurobi">Installing Gurobi</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="workflow.html">Design Survey Workflow</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">aplc-optimization</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Using STScI Linux Servers</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/server.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="using-stsci-linux-servers">
<span id="servers"></span><h1>Using STScI Linux Servers<a class="headerlink" href="#using-stsci-linux-servers" title="Permalink to this headline">¶</a></h1>
<p>Due to the wide parameter space open to the SCDA study, apodizer optimization jobs are often computationally expensive, with some high-resolution design cases requiring
several days to complete. In order to scale up the feasible volume of optimization trails, we utilize back room Linux compute servers at STScI.
There are three shared Telescope servers that can be used for the purpose of coronagraph design work: telserv1, telserv2 and telserv3.
They are physical machines, not virtual machines, and run the Linux operating system.</p>
<p>The Linux virtual workstations can be accessed from any STScI Macintosh or Windows system, on-site or through VPN and
are available to anyone with an Active Directory account. Information on the Telescopes shared computers can be found in
the following STScI <a class="reference external" href="https://innerspace.stsci.edu/display/INSTEL/Telescopes+Shared+Computers">Innerspace page</a>.</p>
<div class="section" id="getting-started">
<h2>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h2>
<div class="section" id="verifying-network-mounts">
<h3>Verifying network mounts<a class="headerlink" href="#verifying-network-mounts" title="Permalink to this headline">¶</a></h3>
<p>In order to access both Central Storage, and the Linux servers, you must be on the STScI internal network
(either physically or wirelessly connected, or via VPN). Before proceeding, it may be useful to verify your
network mounts.</p>
<p>Open a terminal terminal and check that you can list the contents of the <code class="docutils literal notranslate"><span class="pre">/user</span></code> directory as shown:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ls /user
</pre></div>
</div>
<p>If instead, you see something like this…:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ls /user
ls: /user: No such file or directory
</pre></div>
</div>
<p>… then you will need to talk to ITSD.</p>
</div>
<div class="section" id="logging-into-a-server">
<span id="login"></span><h3>Logging into a server<a class="headerlink" href="#logging-into-a-server" title="Permalink to this headline">¶</a></h3>
<p>The command to remotely connect to a given server is <code class="docutils literal notranslate"><span class="pre">ssh</span> <span class="pre">&lt;SERVERNAME&gt;</span></code> (where <code class="docutils literal notranslate"><span class="pre">&lt;SERVERNAME&gt;</span></code> is the server hostname,
e.g. <code class="docutils literal notranslate"><span class="pre">ssh</span> <span class="pre">telserv3</span></code>). To enable X forwarding, you can use the <code class="docutils literal notranslate"><span class="pre">-XY</span></code> option (e.g. <code class="docutils literal notranslate"><span class="pre">ssh</span> <span class="pre">-XY</span> <span class="pre">science1</span></code>). This allows
for displays that use X (Linux’s default backend) to be forwarded to your monitor.</p>
<p>Go ahead and verify that you are able to log in to the TELSERV3 server, as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ssh telserv3
</pre></div>
</div>
<p>By default, the STScI servers run on <code class="docutils literal notranslate"><span class="pre">tsch</span></code> (not <code class="docutils literal notranslate"><span class="pre">bash</span></code>) when you log in. To switch to a <code class="docutils literal notranslate"><span class="pre">bash</span></code> shell use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ bash
</pre></div>
</div>
</div>
</div>
<div class="section" id="software-installation">
<h2>Software Installation<a class="headerlink" href="#software-installation" title="Permalink to this headline">¶</a></h2>
<p>When logged into a server (see <a class="reference internal" href="#login"><span class="std std-ref">below</span></a>), any commands run in that SSH session will be executed on the server, not on your personal machine.
Thus, files and directories on your local machine will not be accessible when running the servers. Instead, all of the
servers have access to network-mounted home directories (i.e. <code class="docutils literal notranslate"><span class="pre">/home/&lt;username&gt;</span></code>) and access to the <code class="docutils literal notranslate"><span class="pre">/user</span></code> space
on Central Store.</p>
<p>Each user has a home directory (<code class="docutils literal notranslate"><span class="pre">/home/&lt;username&gt;</span></code>) that is mounted on each of the Linux machines. This home directory
is mounted and shared among all the machines, so that any file in that directory will be available on each machine.
However, space in this directory is limited (each user has a 10 GB quota) and installing software in the home directory
is usually discouraged.</p>
<p>A user’s Central Storage space is a better choice than the home directory for user-installed software,
as it has considerably more space (at least 850 GB). This directory is shared and mounted on each of the linux machines,
and can also be mounted on the user’s individual computer (when connected to the STScI internal network). This allows for
a convenient way to share and move files among/between the Linux machines and the user’s individual machine.</p>
<p>On the servers, this space is available under the path <code class="docutils literal notranslate"><span class="pre">/user/&lt;username&gt;</span></code>. For Mac users, this directory is
auto-mounted at the same location (i.e. <code class="docutils literal notranslate"><span class="pre">/user/&lt;username&gt;</span></code>). On windows machines, the directory is not auto-mounted,
but is still available at the path <code class="docutils literal notranslate"><span class="pre">\\cs10d\user</span></code>. When installing in this location, it is important to remain aware
of the differences in the operating system among the machines.</p>
<p>Within a SSH session (see <a class="reference internal" href="#login"><span class="std std-ref">Logging into a server</span></a>), verify that you can access your Central Storage directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ls /user/myname
</pre></div>
</div>
<div class="section" id="installing-conda">
<h3>Installing Conda<a class="headerlink" href="#installing-conda" title="Permalink to this headline">¶</a></h3>
<p>It is recommended that the <code class="docutils literal notranslate"><span class="pre">aplc-optimization</span></code> package be installed using Conda (see <span class="xref std std-ref">installing</span>). While you may
have a version of Conda installed to your local machine, this version will not be accessible to programs running on
the servers at STScI (see <a class="reference internal" href="#storage"><span class="std std-ref">above</span></a>). Therefore, in order to install <code class="docutils literal notranslate"><span class="pre">aplc-optimization</span></code> on the servers,
we will first need set up Conda on one of the servers. (Fortunately, you only have to go through the process on <em>one</em>
Linux server to make conda available on <em>all</em> of the Linux servers.)</p>
<p>Because of the storage limitations associated with the Linux home diretory (see <a class="reference internal" href="#storage"><span class="std std-ref">above</span></a>),
we recommend installing Conda your Central Store directory instead.</p>
<p>First ssh into one of the servers:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ssh telserv3
telserv3&gt;
</pre></div>
</div>
<p>Start a <code class="docutils literal notranslate"><span class="pre">bash</span></code> shell:</p>
<blockquote>
<div><p>telserv3&gt; bash
bash$</p>
</div></blockquote>
<p>Change directories to your Central Store directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>bash$ cd &quot;/user/$(logname)&quot;
</pre></div>
</div>
<p>Because the servers at STScI run Linux, you will need to install a <em>Linux</em> version of Conda. Download and install
the latest Miniconda for linux using curl:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>bash$ curl -OL https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh
bash$ bash Miniconda3-latest-Linux-x86_64.sh -b -p &quot;/user/$(logname)/miniconda3&quot;
</pre></div>
</div>
<p>Now add the miniconda folder to the $PATH on the server:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>bash$ echo &quot;export PATH=\&quot;/user/$(logname)/miniconda3/bin:\$PATH\&quot;&quot; &gt;&gt; ~/.bashrc
</pre></div>
</div>
<p>Log out and ssh back into the server again:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>bash$ exit
telserv3&gt; exit
logout
Connection to telserv3.stsci.edu closed.
$ ssh telserv3
telserv3&gt;
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">conda</span></code> command works with <code class="docutils literal notranslate"><span class="pre">bash</span></code>, not <code class="docutils literal notranslate"><span class="pre">tcsh</span></code>; so before you continue, start a bash shell on the server:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>telserv3&gt; bash
bash$
</pre></div>
</div>
<p>Now check that the <code class="docutils literal notranslate"><span class="pre">conda</span></code> command is available:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>bash$ which conda
/user/myname/miniconda3/bin/conda
</pre></div>
</div>
<p>Now that you have the conda command available, we can install <code class="docutils literal notranslate"><span class="pre">aplc-optimization</span></code> on the server.</p>
</div>
<div class="section" id="installing-aplc-optimization">
<h3>Installing <code class="docutils literal notranslate"><span class="pre">aplc-optimization</span></code><a class="headerlink" href="#installing-aplc-optimization" title="Permalink to this headline">¶</a></h3>
<p>Because of the storage limitations associated with the Linux home diretory (see <a class="reference internal" href="#storage"><span class="std std-ref">above</span></a>), we recommend
intalling <code class="docutils literal notranslate"><span class="pre">aplc-optimization</span></code> in your Central Store directory. If you haven’t already, <code class="docutils literal notranslate"><span class="pre">ssh</span></code> into the server and open a
<code class="docutils literal notranslate"><span class="pre">bash</span></code> shell:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ssh telserv3
telserv3&gt; bash
bash$
</pre></div>
</div>
<p>Go to your user directory on Central Store and clone the <code class="docutils literal notranslate"><span class="pre">aplc-optimization</span></code> repository:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>bash$ cd /user/$(logname)/
bash$ git clone https://github.com/spacetelescope/aplc-optimization.git
</pre></div>
</div>
<p>Create a new Conda environment on the Server using the <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>bash$ cd aplc_optimization
bash$ conda env create --file environment.yml
bash$ source activate aplc-optimization
(aplc-optimization) bash$
</pre></div>
</div>
</div>
<div class="section" id="installing-gurobi">
<h3>Installing Gurobi<a class="headerlink" href="#installing-gurobi" title="Permalink to this headline">¶</a></h3>
<p>Go back into your Central Store directory and download the latest 64-bit Linux version of the Gurobi optimizer, using <code class="docutils literal notranslate"><span class="pre">curl</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(aplc-optimization) bash$ cd /user/bnickson
(aplc-optimization) bash$ curl -OL https://packages.gurobi.com/9.0/gurobi9.0.2_linux64.tar.gz
</pre></div>
</div>
<p>Open and extract the <code class="docutils literal notranslate"><span class="pre">.tar.gz</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(aplc-optimization) bash$ tar xvzf gurobi9.0.2_linux64.tar.gz
</pre></div>
</div>
<div class="section" id="obtain-a-new-gurobi-license">
<h4>Obtain a new Gurobi license<a class="headerlink" href="#obtain-a-new-gurobi-license" title="Permalink to this headline">¶</a></h4>
<p>Academic users are able to install and license Gurobi for their own use on more than one machine, however each
individual academic license can only be installed on a single physical machine. Consequently, in order to use the optimizer
on any of the Linux machines, a new individual academic license must be obtained (aside from the license previously
obtained for your personal machine).</p>
<p>Log into the Gurobi website and visit the <a class="reference external" href="https://www.gurobi.com/downloads/end-user-license-agreement-academic/">Academic License page</a>
and request a new free license. Once obtained, this new license will be visible in your
<a class="reference external" href="https://www.gurobi.com/downloads/licenses/">Current Gurobi Licenses</a> library.</p>
<p>Go to your <a class="reference external" href="https://www.gurobi.com/downloads/licenses/">Current Gurobi Licenses</a> library and open
the newly created license by clicking on the <strong>Licence ID</strong> number.</p>
</div>
<div class="section" id="retrieve-and-set-up-the-gurobi-license-on-the-server">
<h4>Retrieve and set up the Gurobi license on the server<a class="headerlink" href="#retrieve-and-set-up-the-gurobi-license-on-the-server" title="Permalink to this headline">¶</a></h4>
<p>The next step is to install the new Gurobi license on the Linux machine. First, log in to the server
and go to the <code class="docutils literal notranslate"><span class="pre">/user</span></code> directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ssh telserv3
telserv3&gt; bash
bash$ cd &quot;/user/$(logname)&quot;
</pre></div>
</div>
<p>After navigating to the <strong>License Detail</strong> page on the Gurobi website, copy and paste the <code class="docutils literal notranslate"><span class="pre">grbgetkey</span></code> command provided to
install the <code class="docutils literal notranslate"><span class="pre">gurobi.lic</span></code> file on the Linux machine.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>While both the Linux machines and your personal machines have access to the <code class="docutils literal notranslate"><span class="pre">/user</span></code> space on Central Store,
it is important that the Gurobi license only be installed whilst connected to the server. When the
<code class="docutils literal notranslate"><span class="pre">grbgetkey</span></code> command is run, it passes identifying information about the machine it is run on to the Gurobi key server, and the server responds with a
license key registered to that particular machine. As such, if the <code class="docutils literal notranslate"><span class="pre">grbgetkey</span></code> command is run whilst not connected to the server,
the corresponding license will be registered to your personal machine and will be invalid for use while connected to the server.</p>
</div>
</div>
<div class="section" id="test-the-license-on-the-server">
<h4>Test the license on the server<a class="headerlink" href="#test-the-license-on-the-server" title="Permalink to this headline">¶</a></h4>
<p>Once you have obtained a license key for the Linux machines, you can test the license using the Gurobi interactive shell.
Log out and back in to the server and run the <code class="docutils literal notranslate"><span class="pre">gurobi.sh</span></code> command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>telserv3&gt; quit
Logging out...
$ ssh telserv3
telserv3&gt; gurobi.sh
Using license file /user/($logname)/gurobi/gurobi.lic
Academic license - for non-commercial use only

Gurobi Interactive Shell (mac64), Version 9.0.1
Copyright (c) 2020, Gurobi Optimization, LLC
Type &quot;help()&quot; for help

gurobi&gt;
</pre></div>
</div>
<p>If the above output is produced by the Gurobi shell, the license is functioning correctly.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If the Gurobi shell doesn’t produce the desired output, there’s a problem with your license. Visit the
<a class="reference external" href="https://www.gurobi.com/documentation/9.0/quickstart_mac/testing_your_license.html#subsection:testlicense">Gurobi website</a>
for troubleshooting tips.</p>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="workflow.html" class="btn btn-neutral float-right" title="Design Survey Workflow" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="installing.html" class="btn btn-neutral float-left" title="Requirements &amp; Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Bryony Nickson.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>